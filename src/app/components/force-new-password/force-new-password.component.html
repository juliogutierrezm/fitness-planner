<div class="auth-page">
  <div class="auth-wrapper">
    <!-- Card -->
    <mat-card class="auth-card">
      <mat-card-content>
        <!-- Logo Section (integrated) -->
        <div class="auth-logo">
          <img src="assets/SpeedUpCoachLogoPNG.png" alt="SpeedUp Coach" />
        </div>

        <div class="auth-header">
          <h1>Actualiza tu contraseña</h1>
          <p>Debes establecer una nueva contraseña para continuar.</p>
          <p class="auth-email" *ngIf="email">Cuenta: {{ email }}</p>
        </div>

        <div class="error-banner" *ngIf="error">
          <mat-icon>error_outline</mat-icon>
          {{ error }}
        </div>

        <form class="auth-form" [formGroup]="form" (ngSubmit)="submit()">
          <mat-form-field *ngIf="requiresGivenName" appearance="outline">
            <mat-label>Nombre</mat-label>
            <input matInput type="text" formControlName="givenName" autocomplete="given-name" placeholder="Tu nombre">
            <mat-error *ngIf="form.get('givenName')?.hasError('required')">
              Ingresa tu nombre.
            </mat-error>
          </mat-form-field>

          <mat-form-field *ngIf="requiresFamilyName" appearance="outline">
            <mat-label>Apellido</mat-label>
            <input matInput type="text" formControlName="familyName" autocomplete="family-name" placeholder="Tu apellido">
            <mat-error *ngIf="form.get('familyName')?.hasError('required')">
              Ingresa tu apellido.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Nueva contraseña</mat-label>
            <input matInput [type]="showPassword ? 'text' : 'password'" formControlName="password" autocomplete="new-password" placeholder="••••••••">
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="togglePassword()"
              [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'"
            >
              <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="form.get('password')?.hasError('required')">
              Ingresa una contraseña.
            </mat-error>
            <mat-error *ngIf="form.get('password')?.hasError('minlength')">
              Debe tener al menos 8 caracteres.
            </mat-error>
            <mat-error *ngIf="form.get('password')?.hasError('uppercase')">
              Debe incluir al menos una letra mayúscula.
            </mat-error>
            <mat-error *ngIf="form.get('password')?.hasError('lowercase')">
              Debe incluir al menos una letra minúscula.
            </mat-error>
            <mat-error *ngIf="form.get('password')?.hasError('number')">
              Debe incluir al menos un número.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Repite la nueva contraseña</mat-label>
            <input
              matInput
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              autocomplete="new-password"
              placeholder="••••••••"
            >
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="toggleConfirmPassword()"
              [attr.aria-label]="showConfirmPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'"
            >
              <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="form.get('confirmPassword')?.hasError('required')">
              Repite la contraseña.
            </mat-error>
            <mat-error *ngIf="form.hasError('mismatch') && form.get('confirmPassword')?.touched">
              Las contraseñas no coinciden.
            </mat-error>
          </mat-form-field>

          <p class="helper-text">Usa mínimo 8 caracteres, mayúsculas, minúsculas y números.</p>

          <button mat-flat-button class="auth-primary" type="submit" [disabled]="loading">
            <span *ngIf="!loading">Guardar contraseña</span>
            <span *ngIf="loading">Actualizando...</span>
          </button>
        </form>

        <div class="auth-footer">
          <span>¿Quieres volver?</span>
          <a mat-button class="link-button" [routerLink]="['/login']">Iniciar sesión</a>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Footer -->
    <p class="auth-copyright">© 2026 SpeedUp Coach. Todos los derechos reservados.</p>
  </div>
</div>
