<div class="plan-detail-page">
  <header class="plan-detail-header">
    <div class="plan-header-top">
      <button class="nav-back" type="button" (click)="goBack()" aria-label="Volver a planes">
        <mat-icon aria-hidden="true">arrow_back</mat-icon>
      </button>
      <div class="plan-header-main" *ngIf="plan && !isLoading">
        <h1 class="plan-title">{{ planTitle }}</h1>
        <div class="plan-header-meta">
          <span class="plan-sessions">
            <mat-icon aria-hidden="true">event</mat-icon>
            <span>{{ getSessionCount(plan) }} sesiones</span>
          </span>
        </div>
      </div>
      <span class="plan-chip liquid-meta" *ngIf="plan?.date && !isLoading">{{ plan?.date | date:'dd/MM/yyyy' }}</span>
    </div>
  </header>

  <div
    class="plan-loading"
    *ngIf="isLoading"
    role="status"
    aria-live="polite"
    [attr.aria-busy]="isLoading">
    <mat-spinner diameter="32"></mat-spinner>
    <p>Cargando plan...</p>
  </div>

  <section class="plan-sessions-section" *ngIf="!isLoading && plan">
    <details class="progressions-accordion liquid-card" *ngIf="plan.progressions?.showProgressions">
      <summary>Progresiones semanales</summary>
      <p class="progressions-subtitle">Guia — no modifica el plan base</p>
      <div class="progressions-weeks">
        <article class="progressions-week" *ngFor="let week of plan.progressions?.weeks || []; trackBy: trackByProgressionWeek">
          <div class="week-heading">
            <span class="week-label">Semana {{ week.week }}</span>
            <span class="week-title" *ngIf="week.title">— {{ week.title }}</span>
          </div>
          <p class="week-note">{{ week.note }}</p>
        </article>
      </div>
    </details>

    <h2>Sesiones</h2>
    <div class="sessions-list">
      <article
        class="client-card session-card liquid-card"
        *ngFor="let session of sessionList; let i = index"
        role="button"
        tabindex="0"
        (click)="openSession(i)"
        (keydown)="onSessionKeydown($event, i)"
        [attr.aria-label]="getSessionAriaLabel(session, i)">
        <div class="session-main">
          <div class="session-title">{{ getSessionTitle(session, i) }}</div>
          <div class="session-meta">
            <div class="session-chips">
              <span class="session-chip liquid-meta" *ngIf="getSessionPrimaryMuscle(session) as muscle">
                {{ muscle }}
              </span>
              <span class="session-chip liquid-meta" *ngIf="isSessionFunctional(session)">Funcional</span>
              <span class="session-chip liquid-meta">{{ getSessionItemsCount(session) }} ejercicios</span>
            </div>
          </div>
        </div>
        <mat-icon class="session-chevron" aria-hidden="true">chevron_right</mat-icon>
      </article>

      <div class="sessions-empty" *ngIf="!sessionList.length">
        <mat-icon aria-hidden="true">event_busy</mat-icon>
        <p>Este plan aun no tiene sesiones asignadas.</p>
      </div>
    </div>
  </section>

  <div class="plan-empty" *ngIf="!isLoading && planMissing">
    <mat-icon aria-hidden="true">event_busy</mat-icon>
    <p>No encontramos este plan.</p>
    <button class="client-button" type="button" (click)="goBack()">Volver</button>
  </div>
</div>
